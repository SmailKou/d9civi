<?php declare(strict_types=1);

/**
 * @file designer makers .module file used to alter some behaviors.
 */

use Civi\Api4\CustomField;
use Civi\Api4\CustomGroup;
use Civi\Api4\Group;
/**
 * Implements hook_install().
 */
function designermakers_install() {
  try {
    // Check if 'Product' custom group already exists
    $existingGroup = CRM_Core_DAO::singleValueQuery("
      SELECT id
      FROM civicrm_custom_group
      WHERE title = 'Product'
    ");

    if ($existingGroup) {
      \Drupal::logger('designermakers')->warning('Product custom group already exists.');
      return;
    }

    // Create 'Product' custom field group
    CRM_Core_DAO::executeQuery("
      INSERT INTO civicrm_custom_group (title, extends, is_active, table_name, name)
      VALUES ('Product', 'Individual', 1, 'civicrm_value_product', 'Product')
    ");

    // Retrieve the custom group ID
    $custom_group_id = CRM_Core_DAO::singleValueQuery("
      SELECT id
      FROM civicrm_custom_group
      WHERE title = 'Product'
    ");

    // Custom fields for 'Product'
    $productFields = [
      ['label' => 'Business Logo', 'data_type' => 'String', 'html_type' => 'File'],
      ['label' => 'Tag Line', 'data_type' => 'String', 'html_type' => 'Text'],
      ['label' => 'Product Images', 'data_type' => 'String', 'html_type' => 'File'],
      ['label' => 'Description', 'data_type' => 'Memo', 'html_type' => 'TextArea'],
      ['label' => 'Art Category', 'data_type' => 'String', 'html_type' => 'Select'],
    ];

    foreach ($productFields as $field) {
      CRM_Core_DAO::executeQuery("
        INSERT INTO civicrm_custom_field (custom_group_id, label, data_type, html_type, is_active)
        VALUES ({$custom_group_id}, '{$field['label']}', '{$field['data_type']}', '{$field['html_type']}', 1)
      ");
    }

    \Drupal::logger('designermakers')->notice('Operation Successful!');
  } catch (\Exception $e) {
    \Drupal::logger('designermakers')->error('Error creating Product custom group: @message', ['@message' => $e->getMessage()]);
  }
}
